@if (isPageReady) {
<div class="container-fluid py-4 main-container">
    <div class="col-xl-10 col-lg-11 mx-auto">
        <!-- Hero Banner (Option 4 Style) -->
        <div class="hero-banner">
            <div class="hero-content">
                <div class="hero-left">
                    <p class="hero-greeting">Welcome back</p>
                    <h1 class="hero-title">Your Meetings Dashboard</h1>
                    <p class="hero-subtitle">Manage your video conferences and schedule new meetings</p>
                    <div class="hero-stats">
                        <div class="stat-item">
                            <div class="stat-icon">
                                <i class="fa-solid fa-video"></i>
                            </div>
                            <div class="stat-info">
                                <h4>{{ allQuickMeeting?.length || 0 }}</h4>
                                <p>Quick Meetings</p>
                            </div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-icon">
                                <i class="fa-regular fa-calendar-check"></i>
                            </div>
                            <div class="stat-info">
                                <h4>{{ allSchedularMeeting?.length || 0 }}</h4>
                                <p>Scheduled</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="hero-right">
                    <p class="hero-time">{{ today | date: 'HH:mm' }}</p>
                    <p class="hero-date">{{ today | date: 'EEEE, MMMM d, y' }}</p>
                </div>
            </div>
        </div>

        <!-- Action Cards -->
        <div class="row g-4 mb-5">
            <div class="col-md-4">
                <div class="action-card create" (click)="quickMeetingModal()">
                    <div class="icon-wrapper">
                        <i class="fa-solid fa-plus"></i>
                    </div>
                    <h5>Create Meeting</h5>
                    <p>Start an instant meeting now</p>
                </div>
            </div>
            <div class="col-md-4">
                <div class="action-card join" (click)="joinMeetingPopup()">
                    <div class="icon-wrapper">
                        <i class="fa-solid fa-right-to-bracket"></i>
                    </div>
                    <h5>Join Meeting</h5>
                    <p>Enter a meeting ID to connect</p>
                </div>
            </div>
            <div class="col-md-4">
                <div class="action-card schedule" (click)="scheduleMeetingPopup()">
                    <div class="icon-wrapper">
                        <i class="fa-regular fa-calendar-plus"></i>
                    </div>
                    <h5>Schedule Meeting</h5>
                    <p>Plan a meeting for later</p>
                </div>
            </div>
        </div>

        <!-- Quick Meetings Section -->
        <div class="section-header">
            <h2 class="section-title">
                <i class="fa-solid fa-bolt"></i>
                Quick Meetings
            </h2>
            @if (allMeetings != null && allMeetings.length > 3) {
            <a href="javascript:void(0)" class="section-link" (click)="toggleView()">
                {{ showAll ? 'Show less' : 'View all' }}
                <i class="fa-solid fa-chevron-right ms-1"></i>
            </a>
            }
        </div>

        <div class="row g-4 mb-5">
            @for (item of visibleRecords; track $index) {
            <div class="col-md-4">
                <div class="meeting-card">
                    <div class="d-flex align-items-start justify-content-between mb-3">
                        <div class="meeting-icon">
                            <i class="fa-solid fa-star"></i>
                        </div>
                        <button class="menu-btn">
                            <i class="fa-solid fa-ellipsis-vertical"></i>
                        </button>
                    </div>
                    <h5 class="meeting-title text-truncate mb-2" [ngbTooltip]="item.title" placement="top">
                        {{ item.title }}
                    </h5>
                    <div class="meeting-meta mb-3">
                        <i class="fa-regular fa-clock"></i>
                        {{ item.startDate | date: 'MMM d, y • h:mm a' }}
                    </div>
                    <div class="d-flex gap-2">
                        <button class="btn-action-primary flex-grow-1" (click)="joinMeeting(item)">
                            <i class="fa-solid fa-play me-1"></i> Join
                        </button>
                        <button class="btn-action-secondary flex-grow-1" (click)="copyLink(item, t)"
                            [ngbTooltip]="'Copied!'" triggers="manual" #t="ngbTooltip">
                            <i class="fa-solid fa-share-nodes me-1"></i> Share
                        </button>
                    </div>
                </div>
            </div>
            }

            <!-- Empty State -->
            @if (!visibleRecords || visibleRecords.length === 0) {
            <div class="col-12">
                <div class="empty-state">
                    <div class="empty-icon">
                        <i class="fa-solid fa-video-slash"></i>
                    </div>
                    <h3 class="empty-title">No meetings yet</h3>
                    <p class="empty-desc">Create your first meeting to get started!</p>
                </div>
            </div>
            }
        </div>

        <!-- Scheduled Meetings Section -->
        @if (allSchedularMeeting && allSchedularMeeting.length > 0) {
        <div class="section-header">
            <h2 class="section-title">
                <i class="fa-regular fa-calendar-days"></i>
                Scheduled Meetings
            </h2>
            <a href="javascript:void(0)" class="section-link">
                View calendar
                <i class="fa-solid fa-chevron-right ms-1"></i>
            </a>
        </div>

        <div class="row g-4">
            @for (item of allSchedularMeeting; track $index) {
            <div class="col-lg-6">
                <div class="schedule-card">
                    <div class="date-badge">
                        <span class="month">{{ item.startDate | date: 'MMM' }}</span>
                        <span class="day">{{ item.startDate | date: 'dd' }}</span>
                    </div>
                    <div class="schedule-content">
                        <h5 class="schedule-title text-truncate">{{ item.title || 'Meeting' }}</h5>
                        <div class="time-box">
                            <div class="time-row">
                                <i class="fa-solid fa-play"></i>
                                {{ item.startDate | date: 'EEEE, MMM d, y' }} • {{ item.startDate | date: 'h:mm a' }}
                            </div>
                            <div class="time-row">
                                <i class="fa-solid fa-stop"></i>
                                {{ item.endDate | date: 'EEEE, MMM d, y' }} • {{ item.endDate | date: 'h:mm a' }}
                            </div>
                        </div>
                        <div class="organizer">
                            <i class="fa-solid fa-user"></i>
                            {{ item.organizerName }}
                        </div>
                        <div class="d-flex gap-2 flex-wrap">
                            <button class="btn-action-primary" (click)="joinMeeting(item)">Join</button>
                            <button class="btn-action-secondary" (click)="shareInviteLink(item, st)"
                                [ngbTooltip]="'Copied!'" triggers="manual" #st="ngbTooltip">
                                Share invite
                            </button>
                            <button class="btn-action-secondary" (click)="shareIdPasscodeLink(item, pt)"
                                [ngbTooltip]="'Copied!'" triggers="manual" #pt="ngbTooltip">
                                ID & Code
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            }
        </div>
        }
    </div>
</div>
} @else {
<div class="vh-100 d-flex align-items-center justify-content-center loading-wrapper">
    <div class="spinner-custom"></div>
</div>
}

<!-- Schedule Meeting Modal -->
<div class="modal fade" id="createMeeting" tabindex="-1" aria-labelledby="createMeetingLabel" aria-hidden="true"
    data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog modal-dialog-centered modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="createMeetingLabel">
                    <i class="fa-regular fa-calendar-plus me-2 text-primary"></i>
                    Schedule a Meeting
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form [formGroup]="meetingForm">
                    <div class="mb-4">
                        <label class="form-label">Meeting Title <span class="text-danger">*</span></label>
                        <input type="text" placeholder="Enter meeting title" class="form-control"
                            formControlName="title"
                            [ngClass]="{'error-field':isSubmitted && meetingForm.controls['title'].errors !== null && meetingForm.controls['title'].errors['required']}">
                    </div>
                    <div class="row mb-4">
                        <div class="col-md-5">
                            <label class="form-label">Start Date & Time <span class="text-danger">*</span></label>
                            <div class="row g-2">
                                <div class="col-7">
                                    <div class="input-group"
                                        [ngClass]="{'error-field':isSubmitted && meetingForm.controls['startDate'].errors !== null && meetingForm.controls['startDate'].errors['required']}">
                                        <input class="form-control" placeholder="Select date" name="dp"
                                            [minDate]="minPickerDate" [(ngModel)]="meetingDate"
                                            [ngModelOptions]="{standalone: true}" ngbDatepicker #md="ngbDatepicker"
                                            (dateSelect)="onMeetingDateSelect($event)" />
                                        <button class="btn btn-outline-secondary" (click)="md.toggle()" type="button">
                                            <i class="fa-solid fa-calendar-days"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="col-5">
                                    <select class="form-select" formControlName="startTime"
                                        [ngClass]="{'error-field':isSubmitted && meetingForm.controls['startTime'].errors !== null && meetingForm.controls['startTime'].errors['required']}"
                                        (change)="onstartTimeSelect()">
                                        <option [value]="null">Time</option>
                                        @for (item of meetingTimes; track $index) {
                                        <option [value]="item">{{ item }}</option>
                                        }
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-2 d-flex align-items-end justify-content-center pb-2">
                            <span class="badge bg-light text-dark px-3 py-2">{{ duration }}</span>
                        </div>
                        <div class="col-md-5">
                            <label class="form-label">End Date & Time <span class="text-danger">*</span></label>
                            <div class="row g-2">
                                <div class="col-7">
                                    <div class="input-group"
                                        [ngClass]="{'error-field':isSubmitted && meetingForm.controls['endDate'].errors !== null && meetingForm.controls['endDate'].errors['required']}">
                                        <input class="form-control" placeholder="Select date" name="dp"
                                            [minDate]="minEndPickerDate" (dateSelect)="onMeetingEndDateSelect($event)"
                                            [(ngModel)]="meetingEndDate" [ngModelOptions]="{standalone: true}"
                                            ngbDatepicker #med="ngbDatepicker" />
                                        <button class="btn btn-outline-secondary" (click)="med.toggle()" type="button">
                                            <i class="fa-solid fa-calendar-days"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="col-5">
                                    <select class="form-select" formControlName="endTime"
                                        [ngClass]="{'error-field':isSubmitted && meetingForm.controls['endTime'].errors !== null && meetingForm.controls['endTime'].errors['required']}"
                                        (change)="onEndTimeSelect()">
                                        <option [value]="null">Time</option>
                                        @for (item of meetingTimes; track $index) {
                                        <option [value]="item">{{ item }}</option>
                                        }
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div>
                        <label class="form-label">Description</label>
                        <textarea rows="3" placeholder="Add meeting agenda or notes..." formControlName="agenda"
                            class="form-control"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-modal-secondary" data-bs-dismiss="modal">Cancel</button>
                <button class="btn-modal-primary" [disabled]="isLoading" (click)="saveMeetingDetail()">
                    @if (isLoading) {
                    <i class="fa-solid fa-spinner fa-spin me-1"></i>
                    }
                    {{ isLoading ? 'Scheduling...' : 'Schedule Meeting' }}
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Quick Meeting Modal -->
<div class="modal fade" id="quickMeetingModal" tabindex="-1" aria-labelledby="quickMeetingModalLabel" aria-hidden="true"
    data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="quickMeetingModalLabel">
                    <i class="fa-solid fa-bolt me-2 text-warning"></i>
                    Quick Meeting
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div>
                    <label class="form-label">Meeting Title <span class="text-danger">*</span></label>
                    <input type="text" placeholder="Enter a title for your meeting" class="form-control"
                        [(ngModel)]="quickMeetingTitle"
                        [ngClass]="{'error-field':isSubmitted && quickMeetingTitle == ''}">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-modal-secondary" data-bs-dismiss="modal">Cancel</button>
                <button class="btn-modal-primary" [disabled]="isLoading" (click)="generateQuickMeeting()">
                    @if (isLoading) {
                    <i class="fa-solid fa-spinner fa-spin me-1"></i>
                    }
                    {{ isLoading ? 'Creating...' : 'Start Meeting' }}
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Join Meeting Modal -->
<div class="modal fade" id="joinMeetingModal" tabindex="-1" aria-labelledby="joinMeetingModalLabel" aria-hidden="true"
    data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="joinMeetingModalLabel">
                    <i class="fa-solid fa-right-to-bracket me-2 text-success"></i>
                    Join Meeting
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label class="form-label">Meeting ID <span class="text-danger">*</span></label>
                    <input type="number" placeholder="Enter meeting ID" class="form-control"
                        [(ngModel)]="meetingDetail.meetingId"
                        [ngClass]="{'error-field':isSubmitted && (meetingDetail.meetingId == '' || meetingDetail.meetingId == null)}">
                </div>
                <div>
                    <label class="form-label">Passcode <span class="text-danger">*</span></label>
                    <input type="text" placeholder="Enter passcode" class="form-control"
                        [(ngModel)]="meetingDetail.meetingPassword"
                        [ngClass]="{'error-field':isSubmitted && (meetingDetail.meetingPassword == '' || meetingDetail.meetingPassword == null)}">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-modal-secondary" data-bs-dismiss="modal">Cancel</button>
                <button class="btn-modal-primary" [disabled]="isLoading" (click)="JoinMeetingBydId()">
                    @if (isLoading) {
                    <i class="fa-solid fa-spinner fa-spin me-1"></i>
                    }
                    {{ isLoading ? 'Joining...' : 'Join Now' }}
                </button>
            </div>
        </div>
    </div>
</div>