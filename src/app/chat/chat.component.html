@if (isPageReady) {
<div class="container-fluid h-100">
    <div class="row vh-100">
        <div class="col-md-3 bg-light main-container overflow-hidden me-0 px-0">
            <div class="col-md-12" style="height: 3rem">
                <div class="card border-0 py-2 px-3">
                    <div class="col py-1">
                        <div class="d-flex align-items-center p-0 m-0 rounded-0 form-control">
                            <i class="fa-solid fa-magnifying-glass px-2"></i>
                            <input type="text" class="form-control border-0" placeholder="Serach......" />
                        </div>
                    </div>
                </div>
            </div>
            @for (item of alluser; track $index) {
            <a href="javascript:void(0)" class="text-decoration-none text-dark pe-3" (click)="selectUser(item)">
                <div
                    class="row py-2 px-3"
                    [@highlightAnim]="item.userId == user.userId ? 'selected' : 'normal'"
                    [ngClass]="{ 'mt-3': $index == 0 }"
                >
                    <div class="col-auto">
                        <div
                            class="avatar rounded-circle d-flex align-items-center justify-content-center fw-semibold"
                            [ngStyle]="{ 'background-color': getColorFromName(item.firstName, item.lastName) }"
                        >
                            {{ getUserInitiaLetter(item.firstName, item.lastName) }}
                        </div>
                    </div>
                    <div class="col">
                        <div class="row align-items-center justify-content-between">
                            <div class="col-md-8 text-truncate">
                                {{ item.firstName }}
                                {{ item.lastName != null && item.lastName != "" ? item.lastName : "" }}
                            </div>
                            <div class="col-auto">
                                {{ today | date : "h:mm a" }}
                            </div>
                        </div>
                        <p class="mb-0">Sounds good?</p>
                    </div>
                </div>
            </a>
            }
        </div>
        <div class="col-md-9 shadow-sm border bg-white px-0 mx-0">
            <div class="card border-0 shadow-sm m-0 p-2">
                <div class="d-flex align-items-center">
                    <div class="col-auto">
                        <div
                            class="avatar rounded-circle d-flex align-items-center justify-content-center fw-semibold"
                            [ngStyle]="{ 'background-color': getColorFromName(user.firstName, user.lastName) }"
                        >
                            {{ getUserInitiaLetter(user.firstName, user.lastName) }}
                        </div>
                    </div>
                    <span class="fw-bold ps-3"
                        >{{ user.firstName }}
                        {{ user.lastName != null && user.lastName != "" ? user.lastName : "" }}</span
                    >
                </div>
            </div>

            <!-- Chat Input -->
            <div class="chat-container p-3">
                <!-- Loop through messages -->
                <div *ngFor="let msg of chatMessages()">
                    <!-- SENT message bubble -->
                    <div *ngIf="msg.message.senderId === currentUserId" class="d-flex justify-content-end mb-2">
                        <div class="chat-bubble me-bubble">
                            <div class="bubble-text">{{ msg.message.body }}</div>

                            <div class="bubble-meta d-flex align-items-center gap-1">
                                <small class="text-muted">{{ formatTime(msg.message.timestamp) }}</small>

                                <ng-container [ngSwitch]="msg.message.status">
                                    <!-- SENT (single grey tick) -->
                                    <svg *ngSwitchCase="0" width="16" height="16" viewBox="0 0 16 16">
                                        <path
                                            fill="#9e9e9e"
                                            d="M6.003 11.803L2.2 8l1.4-1.4 2.403 2.397 5.397-5.397 1.4 1.4z"
                                        />
                                    </svg>

                                    <!-- DELIVERED (double grey tick) -->
                                    <svg *ngSwitchCase="1" xmlns="http://www.w3.org/2000/svg" width="20" height="16" viewBox="0 0 20 16">
                                        <!-- First tick -->
                                        <path
                                            fill="#9e9e9e"
                                            d="M6.003 11.803L2.2 8l1.4-1.4 2.403 2.397 5.397-5.397 1.4 1.4z"
                                        />

                                        <!-- Second tick (shifted right) -->
                                        <path
                                            fill="#9e9e9e"
                                            transform="translate(4,0)"
                                            d="M6.003 11.803L2.2 8l1.4-1.4 2.403 2.397 5.397-5.397 1.4 1.4z"
                                        />
                                    </svg>

                                    <!-- SEEN (blue double tick) -->
                                    <svg *ngSwitchCase="2" xmlns="http://www.w3.org/2000/svg" width="20" height="16" viewBox="0 0 20 16">
                                        <!-- First tick -->
                                        <path
                                            fill="#4fc3f7"
                                            d="M6.003 11.803L2.2 8l1.4-1.4 2.403 2.397 5.397-5.397 1.4 1.4z"
                                        />

                                        <!-- Second tick (shifted right) -->
                                        <path
                                            fill="#4fc3f7"
                                            transform="translate(4,0)"
                                            d="M6.003 11.803L2.2 8l1.4-1.4 2.403 2.397 5.397-5.397 1.4 1.4z"
                                        />
                                    </svg>
                                </ng-container>
                            </div>
                        </div>
                    </div>

                    <!-- RECEIVED message bubble -->
                    <div *ngIf="msg.message.senderId !== currentUserId" class="d-flex justify-content-start mb-2">
                        <div class="chat-bubble other-bubble">
                            <div class="bubble-text">{{ msg.message.body }}</div>

                            <div class="bubble-meta">
                                <small class="text-muted">{{ formatTime(msg.message.timestamp) }}</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="container position-absolute bottom-0 mb-4">
                <div class="row justify-content-center">
                    <div class="col-md-10">
                        <div class="card border-0 shadow-lg rounded-pill">
                            <div class="card-body p-2">
                                <div class="input-group">
                                    <span class="input-group-text bg-transparent border-0">
                                        <svg
                                            xmlns="http://www.w3.org/2000/svg"
                                            width="20"
                                            height="20"
                                            fill="#6c757d"
                                            viewBox="0 0 16 16"
                                        >
                                            <path
                                                d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"
                                            />
                                            <path
                                                d="M4.285 9.567a.5.5 0 0 1 .683.183A3.498 3.498 0 0 0 8 11.5a3.498 3.498 0 0 0 3.032-1.75.5.5 0 1 1 .866.5A4.498 4.498 0 0 1 8 12.5a4.498 4.498 0 0 1-3.898-2.25.5.5 0 0 1 .183-.683M7 6.5C7 7.328 6.552 8 6 8s-1-.672-1-1.5S5.448 5 6 5s1 .672 1 1.5m4 0c0 .828-.448 1.5-1 1.5s-1-.672-1-1.5S9.448 5 10 5s1 .672 1 1.5"
                                            />
                                        </svg>
                                    </span>
                                    <input
                                        [value]="message()"
                                        (input)="message.set($event.target.value)"
                                        type="text"
                                        class="form-control border-0 bg-transparent"
                                        placeholder="Type your message..."
                                    />
                                    <span class="input-group-text bg-transparent border-0">
                                        <svg
                                            xmlns="http://www.w3.org/2000/svg"
                                            width="20"
                                            height="20"
                                            fill="#6c757d"
                                            viewBox="0 0 16 16"
                                        >
                                            <path
                                                d="M4.5 3a2.5 2.5 0 0 1 5 0v9a1.5 1.5 0 0 1-3 0V5a.5.5 0 0 1 1 0v7a.5.5 0 0 0 1 0V3a1.5 1.5 0 1 0-3 0v9a2.5 2.5 0 0 0 5 0V5a.5.5 0 0 1 1 0v7a3.5 3.5 0 1 1-7 0z"
                                            />
                                        </svg>
                                    </span>
                                    <button class="btn btn-primary rounded-pill px-4" (click)="sendMessage()">
                                        <svg
                                            xmlns="http://www.w3.org/2000/svg"
                                            width="18"
                                            height="18"
                                            fill="currentColor"
                                            viewBox="0 0 16 16"
                                        >
                                            <path
                                                d="M15.854.146a.5.5 0 0 1 .11.54l-5.819 14.547a.75.75 0 0 1-1.329.124l-3.178-4.995L.643 7.184a.75.75 0 0 1 .124-1.33L15.314.037a.5.5 0 0 1 .54.11ZM6.636 10.07l2.761 4.338L14.13 2.576zm6.787-8.201L1.591 6.602l4.339 2.76z"
                                            />
                                        </svg>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
}
