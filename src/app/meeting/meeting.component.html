<div class="d-flex flex-column h-100">
    <div class="conference-section flex-grow-1">
        @if (!room()) {
            <div>Joining Please wait ...</div>
        } @else {
            <div id="room" class="w-100">
                <div id="layout-container" class="video-preview-container">
                    @if (localTrack()) {
                        <video-component
                        [track]="localTrack()!"
                        [participantIdentity]="roomForm.value.participantName!"
                        [local]="true"
                        ></video-component>
                    }
                    @for (remoteTrack of remoteTracksMap().values(); track remoteTrack.trackPublication.trackSid) {
                        @if (remoteTrack.trackPublication.kind === 'video') {
                            <video-component
                            [track]="remoteTrack.trackPublication.videoTrack!"
                            [participantIdentity]="remoteTrack.participantIdentity"
                            ></video-component>
                        } @else {
                            <audio-component [track]="remoteTrack.trackPublication.audioTrack!" hidden></audio-component>
                        }
                    }
                </div>
            </div>
        }
    </div>
    
    <!-- Bottom 10% Area: Controls -->
    <div class="footer-section justify-content-between px-3">
        <div class="footer-left fw-semibold text-white">
            <span class="time">{{currentTime | date:'shortTime'}}</span>
            <span class="room-code">| {{meetingId}}</span>
        </div>

        <div class="footer-center">
            <button class="footer-btn">
                <!-- More Options -->
                <svg xmlns="http://www.w3.org/2000/svg" height="24" width="24" fill="white">
                    <circle cx="5" cy="12" r="2"/>
                    <circle cx="12" cy="12" r="2"/>
                    <circle cx="19" cy="12" r="2"/>
                </svg>
            </button>

            @if (permissions.microphone == 'granted') {
                <button class="footer-btn active" [ngStyle]="{'background-color': isMicOn() ? '#e3e3e3' : '#000'}" (click)="toggleMic()" data-bs-toggle="tooltip" 
                data-bs-placement="top" [attr.title]="isMicOn() ? 'Turn off microphone' : 'Turn on microphone'">                
                    <!-- Mute Mic -->
                    @if (isMicOn()) {
                         <!-- UnMute Mic -->
                         <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#000"><path d="M480-400q-50 0-85-35t-35-85v-240q0-50 35-85t85-35q50 0 85 35t35 85v240q0 50-35 85t-85 35Zm0-240Zm-40 520v-123q-104-14-172-93t-68-184h80q0 83 58.5 141.5T480-320q83 0 141.5-58.5T680-520h80q0 105-68 184t-172 93v123h-80Zm40-360q17 0 28.5-11.5T520-520v-240q0-17-11.5-28.5T480-800q-17 0-28.5 11.5T440-760v240q0 17 11.5 28.5T480-480Z"/></svg>
                    } @else { 
                       <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#FFFFFF"><path d="m710-362-58-58q14-23 21-48t7-52h80q0 44-13 83.5T710-362ZM480-594Zm112 112-72-72v-206q0-17-11.5-28.5T480-800q-17 0-28.5 11.5T440-760v126l-80-80v-46q0-50 35-85t85-35q50 0 85 35t35 85v240q0 11-2.5 20t-5.5 18ZM440-120v-123q-104-14-172-93t-68-184h80q0 83 57.5 141.5T480-320q34 0 64.5-10.5T600-360l57 57q-29 23-63.5 39T520-243v123h-80Zm352 64L56-792l56-56 736 736-56 56Z"/></svg>
                    }
                </button>
            } @else {
                <button #micBtn class="footer-btn active" style="background-color: #000;" data-bs-toggle="tooltip" data-bs-placement="top" title="Show more info" (click)="showUserMicActivePopup()">                
                    <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#FFFFFF"><path d="M400-400q-50 0-85-35t-35-85v-240q0-50 35-85t85-35q50 0 85 35t35 85v240q0 50-35 85t-85 35Zm0-80q17 0 28.5-11.5T440-520v-240q0-17-11.5-28.5T400-800q-17 0-28.5 11.5T360-760v240q0 17 11.5 28.5T400-480Zm40 360h-80v-123q-104-14-172-93t-68-184h80q0 83 58.5 141.5T400-320q11 0 20.5-1t19.5-3v204Zm240-40q8 0 14-6t6-14q0-8-6-14t-14-6q-8 0-14 6t-6 14q0 8 6 14t14 6Zm-20-80h40v-160h-40v160Zm20 160q-83 0-141.5-58.5T480-280q0-83 58.5-141.5T680-480q83 0 141.5 58.5T880-280q0 83-58.5 141.5T680-80ZM400-640Z"/></svg>
                </button>
            }

            <button class="footer-btn active" (click)="toggleCamera()" [ngStyle]="{'background-color': isCameraOn() ? '#e3e3e3' : '#000'}">
                <!-- Camera -->
                @if(isCameraOn()) {
                    <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#000"><path d="M160-160q-33 0-56.5-23.5T80-240v-480q0-33 23.5-56.5T160-800h480q33 0 56.5 23.5T720-720v180l160-160v440L720-420v180q0 33-23.5 56.5T640-160H160Zm0-80h480v-480H160v480Zm0 0v-480 480Z"/></svg>
                } @else {
                    <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#FFFFFF"><path d="M880-260 720-420v67l-80-80v-287H353l-80-80h367q33 0 56.5 23.5T720-720v180l160-160v440ZM822-26 26-822l56-56L878-82l-56 56ZM498-575ZM382-464ZM160-800l80 80h-80v480h480v-80l80 80q0 33-23.5 56.5T640-160H160q-33 0-56.5-23.5T80-240v-480q0-33 23.5-56.5T160-800Z"/></svg>
                }
            </button>

            <button class="footer-btn" (click)="shareScreen()">
                <!-- Screen Share -->
                 <video class="d-none"
                    #screenPreview
                    autoplay
                    playsinline
                    muted
                    style="width: 100%; border: 2px solid #007bff; border-radius: 8px;"
                ></video>
                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#FFFFFF"><path d="M440-320h80v-166l64 63 57-57-161-160-160 160 57 56 63-63v167ZM160-160q-33 0-56.5-23.5T80-240v-480q0-33 23.5-56.5T160-800h640q33 0 56.5 23.5T880-720v480q0 33-23.5 56.5T800-160H160Zm0-80h640v-480H160v480Zm0 0v-480 480Z"/></svg>
            </button>

            <button class="footer-btn">
                <!-- Raise Hand -->
                <svg xmlns="http://www.w3.org/2000/svg" height="24" width="24" fill="white">
                    <path d="M12 2q.825 0 1.413.588Q14 3.175 14 4v8q0 .825-.587 1.412Q12.825 14 12 14t-1.413-.588Q10 12.825 10 12V4q0-.825.587-1.412Q11.175 2 12 2Z"/>
                    <path d="M17 6q.825 0 1.412.587Q19 7.175 19 8v8q0 .825-.588 1.412Q17.825 18 17 18q-.825 0-1.412-.588Q15 16.825 15 16V8q0-.825.588-1.412Q16.175 6 17 6Z"/>
                    <path d="M7 10q.825 0 1.412.588Q9 11.175 9 12v4q0 .825-.588 1.413Q7.825 18 7 18q-.825 0-1.412-.587Q5 16.825 5 16v-4q0-.825.588-1.412Q6.175 10 7 10Z"/>
                </svg>
            </button>

            <button class="footer-btn end-call" (click)="leaveRoom()">
                <!-- End Call -->
                 <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#FFFFFF"><path d="m136-304-92-90q-12-12-12-28t12-28q88-95 203-142.5T480-640q118 0 232.5 47.5T916-450q12 12 12 28t-12 28l-92 90q-11 11-25.5 12t-26.5-8l-116-88q-8-6-12-14t-4-18v-114q-38-12-78-19t-82-7q-42 0-82 7t-78 19v114q0 10-4 18t-12 14l-116 88q-12 9-26.5 8T136-304Zm104-198q-29 15-56 34.5T128-424l40 40 72-56v-62Zm480 2v60l72 56 40-38q-29-26-56-45t-56-33Zm-480-2Zm480 2Z"/></svg>
                <!-- <svg xmlns="http://www.w3.org/2000/svg" height="24" width="24" fill="white">
                    <path d="M4 14q0-.825.587-1.412Q5.175 12 6 12h3q.825 0 1.413.588Q11 13.175 11 14v3q0 .825-.587 1.412Q9.825 19 9 19H6q-.825 0-1.412-.588Q4 17.825 4 17Zm10 0q0-.825.588-1.412Q15.175 12 16 12h3q.825 0 1.412.588Q21 13.175 21 14v3q0 .825-.588 1.412Q20.175 19 19 19h-3q-.825 0-1.412-.588Q14 17.825 14 17Z"/>
                    <path d="M12 10q-3.95 0-7.4 1.175-1.05.375-1.8 1.2Q2 13.2 2 14.3v5q0 .425.288.712Q2.575 20.3 3 20.3h18q.425 0 .713-.288Q22 19.725 22 19.3v-5q0-1.1-.8-1.925-.75-.825-1.8-1.2Q15.95 10 12 10Z"/>
                </svg> -->
            </button>
        </div>

        <div class="footer-right">
            <svg xmlns="http://www.w3.org/2000/svg" height="24" width="24" fill="white">
                <path d="M12 21q-.825 0-1.412-.588Q10 19.825 10 19V9q0-.825.588-1.412Q11.175 7 12 7t1.412.588Q14 8.175 14 9v10q0 .825-.588 1.412Q12.825 21 12 21Zm-6-4q-.825 0-1.412-.587Q4 15.825 4 15V9q0-.825.588-1.412Q5.175 7 6 7t1.412.588Q8 8.175 8 9v6q0 .825-.588 1.413Q6.825 17 6 17Zm12 0q-.825 0-1.412-.587Q16 15.825 16 15V9q0-.825.588-1.412Q17.175 7 18 7t1.412.588Q20 8.175 20 9v6q0 .825-.588 1.413Q18.825 17 18 17Z"/>
            </svg>
        </div>
    </div>
</div>