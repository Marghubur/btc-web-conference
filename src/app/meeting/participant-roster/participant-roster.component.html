<!-- Shared Participant Roster Component -->
<div class="participant-roster">
    <!-- Roster Header -->
    <div class="roster-header">
        <span class="roster-title">People</span>
        <span class="roster-count">{{meetingService.remoteUsersCount + 1}}</span>
    </div>
    <!-- Filter Search Box -->
    <div class="roster-filter">
        <div class="filter-input-wrapper">
            <svg xmlns="http://www.w3.org/2000/svg" height="16px" viewBox="0 -960 960 960" width="16px"
                fill="currentColor" class="filter-icon">
                <path
                    d="M784-120 532-372q-30 24-69 38t-83 14q-109 0-184.5-75.5T120-580q0-109 75.5-184.5T380-840q109 0 184.5 75.5T640-580q0 44-14 83t-38 69l252 252-56 56ZM380-400q75 0 127.5-52.5T560-580q0-75-52.5-127.5T380-760q-75 0-127.5 52.5T200-580q0 75 52.5 127.5T380-400Z" />
            </svg>
            <input type="text" class="filter-input" placeholder="Search participants..."
                (input)="meetingService.filterParticipants($event)">
        </div>
    </div>
    <!-- Participant List -->
    <div class="roster-list">
        <!-- Section: In this call -->
        <div class="roster-section-header">
            <span>In this call ({{meetingService.remoteUsersCount + 1}})</span>
        </div>
        <!-- Local Participant (You) -->
        <div class="participant-item">
            <div class="participant-avatar-wrapper">
                <div class="participant-avatar"
                    [ngStyle]="{'background-color': meetingService.getColorFromName(roomForm.value.participantName!)}">
                    {{meetingService.getUserInitiaLetter(roomForm.value.participantName!)}}
                </div>
                <span class="status-dot online"></span>
            </div>
            <div class="participant-info">
                <span class="participant-name">{{roomForm.value.participantName!}} (You)</span>
                <span class="participant-status-text">In this meeting</span>
            </div>
            <div class="participant-actions">
                @if (!meetingService.isMicOn()) {
                <span class="action-icon muted" title="Microphone off">
                    <svg xmlns="http://www.w3.org/2000/svg" height="16px" viewBox="0 -960 960 960" width="16px"
                        fill="currentColor">
                        <path
                            d="m710-362-58-58q14-23 21-48t7-52h80q0 44-13 83.5T710-362ZM480-594Zm112 112-72-72v-206q0-17-11.5-28.5T480-800q-17 0-28.5 11.5T440-760v126l-80-80v-46q0-50 35-85t85-35q50 0 85 35t35 85v240q0 11-2.5 20t-5.5 18ZM440-120v-123q-104-14-172-93t-68-184h80q0 83 57.5 141.5T480-320q34 0 64.5-10.5T600-360l57 57q-29 23-63.5 39T520-243v123h-80Zm352 64L56-792l56-56 736 736-56 56Z" />
                    </svg>
                </span>
                }
                @if (!meetingService.isCameraOn()) {
                <span class="action-icon camera-off" title="Camera off">
                    <svg xmlns="http://www.w3.org/2000/svg" height="16px" viewBox="0 -960 960 960" width="16px"
                        fill="currentColor">
                        <path
                            d="M880-260 720-420v67l-80-80v-287H353l-80-80h367q33 0 56.5 23.5T720-720v180l160-160v440ZM822-26 26-822l56-56L878-82l-56 56ZM498-575ZM382-464ZM160-800l80 80h-80v480h480v-80l80 80q0 33-23.5 56.5T640-160H160q-33 0-56.5-23.5T80-240v-480q0-33 23.5-56.5T160-800Z" />
                    </svg>
                </span>
                }
            </div>
        </div>
        <!-- Remote Participants -->
        @for (participant of meetingService.filteredInvitedParticipants(true); track participant.userId) {
        <div class="participant-item">
            <div class="participant-avatar-wrapper">
                <div class="participant-avatar"
                    [ngStyle]="{'background-color': meetingService.getColorFromName(participant.name)}">
                    {{meetingService.getUserInitiaLetter(participant.name)}}
                </div>
                <span class="status-dot online"></span>
            </div>
            <div class="participant-info">
                <span class="participant-name">{{participant.name}}</span>
                <span class="participant-status-text">In this meeting</span>
            </div>
            <div class="participant-actions">
                @if (!meetingService.isParticipantAudioEnabled(participant.email)) {
                <span class="action-icon muted" title="Microphone off">
                    <svg xmlns="http://www.w3.org/2000/svg" height="16px" viewBox="0 -960 960 960" width="16px"
                        fill="currentColor">
                        <path
                            d="m710-362-58-58q14-23 21-48t7-52h80q0 44-13 83.5T710-362ZM480-594Zm112 112-72-72v-206q0-17-11.5-28.5T480-800q-17 0-28.5 11.5T440-760v126l-80-80v-46q0-50 35-85t85-35q50 0 85 35t35 85v240q0 11-2.5 20t-5.5 18ZM440-120v-123q-104-14-172-93t-68-184h80q0 83 57.5 141.5T480-320q34 0 64.5-10.5T600-360l57 57q-29 23-63.5 39T520-243v123h-80Zm352 64L56-792l56-56 736 736-56 56Z" />
                    </svg>
                </span>
                }
                @if (!meetingService.isParticipantCameraEnabled(participant.email)) {
                <span class="action-icon camera-off" title="Camera off">
                    <svg xmlns="http://www.w3.org/2000/svg" height="16px" viewBox="0 -960 960 960" width="16px"
                        fill="currentColor">
                        <path
                            d="M880-260 720-420v67l-80-80v-287H353l-80-80h367q33 0 56.5 23.5T720-720v180l160-160v440ZM822-26 26-822l56-56L878-82l-56 56ZM498-575ZM382-464ZM160-800l80 80h-80v480h480v-80l80 80q0 33-23.5 56.5T640-160H160q-33 0-56.5-23.5T80-240v-480q0-33 23.5-56.5T160-800Z" />
                    </svg>
                </span>
                }
            </div>
        </div>
        }
        <!-- Section Divider -->
        @if (meetingService.invitedParticipants > 0) {
        <div class="roster-divider"></div>
        <!-- Section: Not in this call -->
        <div class="roster-section-header">
            <span>Not in this call ({{meetingService.invitedParticipants}})</span>
        </div>
        @for (invited of meetingService.filteredInvitedParticipants(false); track invited.userId) {
        <div class="participant-item not-in-call">
            <div class="participant-avatar-wrapper">
                <div class="participant-avatar"
                    [ngStyle]="{'background-color': meetingService.getColorFromName(invited.name)}">
                    {{meetingService.getUserInitiaLetter(invited.name)}}
                </div>
                <span class="status-dot offline"></span>
            </div>
            <div class="participant-info">
                <span class="participant-name">{{invited.name}}</span>
                <span class="participant-status-text">{{invited.email}}</span>
            </div>
            <div class="participant-actions">
                @if (isCallingParticipant(invited.userId)) {
                <button class="request-join-btn calling" disabled title="Calling...">
                    <svg xmlns="http://www.w3.org/2000/svg" height="14px" viewBox="0 -960 960 960" width="14px"
                        fill="currentColor" class="calling-icon">
                        <path
                            d="M798-120q-125 0-247-54.5T329-329Q229-429 174.5-551T120-798q0-18 12-30t30-12h162q14 0 25 9.5t13 22.5l26 140q2 16-1 27t-11 19l-97 98q20 37 47.5 71.5T387-386q31 31 65 57.5t72 48.5l94-94q9-9 23.5-13.5T670-390l138 28q14 4 23 14.5t9 23.5v162q0 18-12 30t-30 12Z" />
                    </svg>
                    <span>Calling</span>
                </button>
                } @else {
                <button class="request-join-btn" (click)="requestToJoin(invited)" title="Request to join">
                    <svg xmlns="http://www.w3.org/2000/svg" height="14px" viewBox="0 -960 960 960" width="14px"
                        fill="currentColor">
                        <path
                            d="M720-400v-120H600v-80h120v-120h80v120h120v80H800v120h-80Zm-360-80q-66 0-113-47t-47-113q0-66 47-113t113-47q66 0 113 47t47 113q0 66-47 113t-113 47ZM40-160v-112q0-34 17.5-62.5T104-378q62-31 126-46.5T360-440q66 0 130 15.5T616-378q29 15 46.5 43.5T680-272v112H40Z" />
                    </svg>
                    <span>Request</span>
                </button>
                }
            </div>
        </div>
        }
        }
    </div>
</div>